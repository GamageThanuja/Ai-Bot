<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HotelMate Chatbot</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <div id="chat-box"></div>
    <!-- Animated GIF example -->
  <img id="robot-gif" src="/static/robothello.gif" alt="Animated GIF" style="width:120px; height:120px;" />
<!-- REPLACE the old #input-container block with this -->
<div id="input-container" class="chat-input">
  <span
    id="user-input"
    contenteditable="true"
    aria-label="Type your message"
    data-placeholder="Ask anything..."
  ></span>
  <button id="send-btn" class="icon-btn" aria-label="Send">
    <!-- Lucide SendHorizontal (inline SVG) -->
    <svg id="send-icon" xmlns="http://www.w3.org/2000/svg" width="40" height="40"
      viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
      stroke-linecap="round" stroke-linejoin="round">
      <path d="m3 3 3 9-3 9 19-9Z"></path>
      <path d="M6 12h16"></path>
    </svg>
  </button>
</div>

  <script type="module">
  import { showBotResponseSteps } from "/static/botResponseAnimator.js";

    async function sendMessage() {
      const input = document.getElementById("user-input");
      const chatBox = document.getElementById("chat-box");
      const userText = input.textContent.trim();
      if (!userText) return;

      // Hide the GIF when user sends a message
      const robotGif = document.getElementById("robot-gif");
      if (robotGif) {
        robotGif.style.display = "none";
      }

      const userMsg = document.createElement("div");
      userMsg.className = "message user";
      userMsg.textContent = userText;
      chatBox.appendChild(userMsg);
      input.textContent = "";
      chatBox.scrollTop = chatBox.scrollHeight;

      const res = await fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query: userText })
      });

      const data = await res.json();
      const botText = data.response || "Sorry, I couldn't understand that.";

      // Animate bot response step by step with Next button
      showBotResponseSteps(botText, chatBox);
    }

    const inputEl = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");

    function syncSendDisabled() {
      sendBtn.disabled = inputEl.textContent.trim() === "";
    }
    syncSendDisabled();

    inputEl.addEventListener("input", syncSendDisabled);

    sendBtn.addEventListener("click", () => {
      if (!sendBtn.disabled) sendMessage();
    });

    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        if (!sendBtn.disabled) sendMessage();
      }
    });
  </script>
</body>
</html>